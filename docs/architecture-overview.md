# 体系结构概述

## 总体结构

<div>
  <img src="../images/architecture.png" alt="总体架构图" style="zoom: 33%;" />  
</div>


如上图，整个系统分为四个部分

- 数据采集
- HTTP API
- 节点喂价程序
- 预言机



## 分布式数据模式

针对数据消费需求比较明确，比如——“希望得到某种数字资产的价格”——，或更新频次较低的预言机需求，——“希望得到纽约市的房贷抵押基准利率”——等需求。为了让预言机中的数据更加准确，减少偏差，我们采用了**分布式数据模式**架构来解决喂价机制问题。

数据由多个喂价节点程序提交至“数据聚合合约”中，当满足5/9数据汇总条件时，聚合合约将根据**数据聚合模型**算法将数据消除偏差后，更新至预言机数据合约中。

数据消费者可通过**数据请求接口**直接读取预言机中的数据（如数字资产报价、房产抵押贷款利率等）。

[分散数据模式]() 描述了如何聚合数据，以及消费者契约如何检索这些数据。

## 请求反馈模式

针对请求参数复杂，请求结果长尾类型的数据，使用分布式数据模式定时更新预言机这种方案无疑浪费巨大的Gas费用。

我们采取了**请求反馈模式**，当长尾请求抵达预言机时，预言机将发出一个**数据请求**并发射**数据请求事件**。喂价节点程序会监听来自预言机发射的事件，分析数据需求，启动工作流程，从接口、数据库或其他数据源将所需数据更新至**”数据聚合合约“**中。数据聚合合约将根据**数据聚合模型**将数据整理后更新至预言机。同时根据数据请求参数中的**回调合约地址**及**回调函数方法**将数据返回给**消费者合约**。

[请求反馈模型]() 描述了从单个Oracle源请求数据的链上架构。